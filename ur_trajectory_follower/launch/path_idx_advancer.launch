<launch>
    <arg name="threshold" default="0.01"/>
    <arg name="radius_threshold" default="$(arg threshold)"/>
    <arg name="collinear_threshold" default="$(arg threshold)"/>
    <arg name="virtual_line_threshold" default="$(arg threshold)"/>
    <arg name="prev_idx_dist" default="3"/>
    <arg name="next_idx_dist" default="9"/>
    <arg name="metric" default="virtual line"/> <!-- Options: ["radius", "collinear", "virtual line"] -->
    <arg name="initial_path_index" default="1"/>
    <arg name="use_virtual_bisector" default="true"/> <!-- Options: true (bisector), false (segment) -->

    <!-- Subscribers -->
    <arg name="path_ns" default="" doc="Namespace prefix for UR path-related topics (with or without leading slash)."/>
    <arg name="path_ns_prefix" default="$(eval '/' + path_ns.strip('/') if path_ns else '')"/>
    <arg name="path_topic" default="$(arg path_ns_prefix)/ur_path_transformed"/>
    <arg name="normals_topic" default="$(arg path_ns_prefix)/ur_path_normals"/>
    <!-- <arg name="current_pose_topic" default="/global_nozzle_pose"/> -->
    <arg name="current_pose_topic" default="/mur620a/UR10_r/global_tcp_pose"/>
    <!-- Publishers -->
    <arg name="path_index_topic" default="$(arg path_ns_prefix)/path_index"/>
    <arg name="next_goal_topic" default="$(arg path_ns_prefix)/next_goal"/>
    <arg name="normal_vector_topic" default="$(arg path_ns_prefix)/normal_vector"/>

    <node name="path_index_advancer" pkg="ur_trajectory_follower" type="path_idx_advancer.py" output="screen">
        <!-- Parameters -->
        <param name="radius_threshold" value="$(arg radius_threshold)"/>
        <param name="collinear_threshold" value="$(arg collinear_threshold)"/>
        <param name="virtual_line_threshold" value="$(arg virtual_line_threshold)"/>
        <param name="prev_idx_dist" value="$(arg prev_idx_dist)"/>
        <param name="next_idx_dist" value="$(arg next_idx_dist)"/>
        <param name="metric" value="$(arg metric)"/>
        <param name="use_virtual_bisector" value="$(arg use_virtual_bisector)"/>
        <param name="initial_path_index" value="$(arg initial_path_index)"/>
        <param name="path_topic" value="$(arg path_topic)"/>
        <param name="normals_topic" value="$(arg normals_topic)"/>
        
        <!-- Topic remapping -->
        <!-- Subscribers: -->
        <remap from="/ur_path_transformed" to="$(arg path_topic)"/>
        <remap from="/current_pose" to="$(arg current_pose_topic)"/>
        <!-- Publishers: -->
        <remap from="/path_index" to="$(arg path_index_topic)"/>
        <remap from="/next_goal" to="$(arg next_goal_topic)"/>
        <remap from="/normal_vector" to="$(arg normal_vector_topic)"/>
    </node>
</launch>