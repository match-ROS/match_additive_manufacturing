<launch>
    <arg name="robot_name" default="mur620c" doc="Name of the robot to be used in the launch file." />
    <arg name="start_condition_topic" default="/start_condition" />
    <arg name="wait_for_start_condition" default="true" />
    <arg name="initial_path_index" default="-1" />
    <arg name="path_ns" default="" doc="Namespace prefix for MIR path topics (with or without leading slash)." />
    <arg name="path_ns_prefix" default="$(eval '/' + path_ns.strip('/') if path_ns else '')" />
    <arg name="mir_path_topic" default="$(arg path_ns_prefix)/mir_path_transformed" />
    <arg name="mir_path_timestamps_topic" default="$(arg path_ns_prefix)/mir_path_timestamps" />
    <arg name="mir_path_velocity_topic" default="$(arg path_ns_prefix)/mir_path_velocity" />
    <arg name="path_index_topic" default="$(arg path_ns_prefix)/path_index" />
    <arg name="trajectory_index_topic" default="$(arg path_ns_prefix)/path_index_modified" />
    <!-- Node that runs the path transformer script -->
    <node name="mir_trajectory_follower" pkg="mir_trajectory_follower" type="mir_trajectory_follower.py" output="screen">
        <!-- Transformation parameters -->
        <param name="mir_path_topic" value="$(arg mir_path_topic)" />
        <param name="mir_path_velocity_topic" value="$(arg mir_path_velocity_topic)" />
        <param name="mir_path_timestamps_topic" value="$(arg mir_path_timestamps_topic)" />
        <param name="mir_pose_topic" value="/$(arg robot_name)/mir_pose_simple" />
        <param name="cmd_vel_topic" value="/$(arg robot_name)/cmd_vel" />
        <param name="trajectory_index_topic" value="$(arg trajectory_index_topic)" />
        <param name="override_topic" value="/velocity_override" />
        <param name="start_condition_topic" value="$(arg start_condition_topic)" />
        <param name="wait_for_start_condition" value="$(arg wait_for_start_condition)" />
        <param name="initial_path_index" value="$(arg initial_path_index)" />
    </node>

    <!-- <node name="path_index_modifier" pkg="mir_trajectory_follower" type="path_index_modifier.py" output="screen">
        <param name="initial_path_index" value="$(arg initial_path_index)" />
        <param name="mir_path_topic" value="$(arg mir_path_topic)" />
        <param name="mir_path_timestamps_topic" value="$(arg mir_path_timestamps_topic)" />
        <param name="path_index_topic" value="$(arg path_index_topic)" />
        <param name="path_index_modified_topic" value="$(arg trajectory_index_topic)" />
    </node> -->

    <node name="mir_index_offset_applier" pkg="mir_trajectory_follower" type="mir_index_offset_applier.py" output="screen">
        <param name="gain" value="0.8" />
        <param name="rounding" value="round" />
        <param name="offset_topic" value="$(arg path_ns_prefix)/mir_index_offset" />
        <param name="ur_index_topic" value="$(arg path_index_topic)" />
        <param name="out_topic" value="$(arg trajectory_index_topic)" />
        <param name="start_signal_topic" value="$(arg start_condition_topic)" />
    </node>
</launch>

